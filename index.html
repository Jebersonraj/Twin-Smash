<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Twin Smash</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <style>
    body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background: #f0f0f0; }
    canvas { border: 1px solid black; }
  </style>
</head>
<body>
<script>
  let aeroplane;
  let twinTowers = [];
  let score = 0;
  let gameOver = false;
  let groundY;

  function setup() {
    createCanvas(800, 400);
    groundY = height - 50;
    resetGame();
  }

  function draw() {
    background(255);

    // Ground
    stroke(0);
    line(0, groundY, width, groundY);

    // Aeroplane
    aeroplane.update();
    aeroplane.show();

    if (!gameOver) {
      if (frameCount % 90 === 0) {
        twinTowers.push(new TwinTower());
      }

      for (let i = twinTowers.length - 1; i >= 0; i--) {
        let tower = twinTowers[i];
        tower.update();
        tower.show();

        if (aeroplane.hits(tower)) {
          gameOver = true;
        }

        if (tower.x + tower.w < 0) {
          twinTowers.splice(i, 1);
          score += 10;
        }
      }
    }

    // Score
    textSize(20);
    textAlign(LEFT);
    fill(0);
    text(`Score: ${score}`, 10, 30);

    // Game Over
    if (gameOver) {
      textSize(32);
      textAlign(CENTER);
      fill(200, 0, 0);
      text("ðŸ’¥ Game Over ðŸ’¥", width / 2, height / 2);
      fill(0);
      text(`Final Score: ${score}`, width / 2, height / 2 + 40);
      text("Press SPACE to restart", width / 2, height / 2 + 80);
      noLoop();
    }
  }

  function keyPressed() {
    if (keyCode === 32) { // Spacebar
      if (gameOver) {
        resetGame();
        loop();
      } else {
        aeroplane.jump();
      }
    }
  }

  function resetGame() {
    twinTowers = [];
    score = 0;
    gameOver = false;
    aeroplane = new Aeroplane();
    frameCount = 0;
    twinTowers.push(new TwinTower());
  }

  // === Aeroplane ===
  class Aeroplane {
    constructor() {
      this.x = 50;
      this.y = height / 2;
      this.w = 60;
      this.h = 30;
      this.vy = 0;
      this.gravity = 1;
      this.jumpStrength = -18;
    }

    update() {
      this.vy += this.gravity;
      this.y += this.vy;

      if (this.y >= groundY - this.h) {
        this.y = groundY - this.h;
        this.vy = 0;
      }

      if (this.y < 0) {
        this.y = 0;
        this.vy = 0;
      }
    }

    show() {
      push();
      translate(this.x, this.y);
      fill(150);
      stroke(0);

      rect(5, 10, 50, 10, 5); // body
      fill(100, 100, 255);
      ellipse(50, 15, 10, 8); // cockpit
      fill(150);
      triangle(20, 10, 40, 10, 30, 0); // wings
      triangle(20, 20, 40, 20, 30, 30);
      triangle(0, 10, 0, 20, -10, 15); // tail
      fill(100);
      rect(15, 20, 10, 5); // engine
      pop();
    }

    jump() {
      this.vy = this.jumpStrength;
    }

    hits(tower) {
      return (
              this.x < tower.x + tower.w &&
              this.x + this.w > tower.x &&
              this.y < tower.y &&
              this.y + this.h > tower.y - tower.h
      );
    }
  }

  // === TwinTower ===
  class TwinTower {
    constructor() {
      this.w = 30;
      this.h = random(10, 40); // much shorter towers
      this.x = width;
      this.y = groundY;
      this.speed = -5 - floor(score / 100);
    }

    update() {
      this.x += this.speed;
    }

    show() {
      push();
      translate(this.x, this.y - this.h);

      fill(80);
      rect(0, 0, 12, this.h);
      fill(100);
      rect(18, 0, 12, this.h);

      fill(180, 180, 255);
      for (let y = 5; y < this.h - 5; y += 12) {
        rect(2, y, 4, 3);
        rect(20, y, 4, 3);
      }

      fill(50);
      rect(0, 0, 12, 2);
      rect(18, 0, 12, 2);

      stroke(80);
      line(6, 0, 6, -10);
      ellipse(6, -10, 2.5, 2.5);

      pop();
    }
  }
</script>
</body>
</html>
